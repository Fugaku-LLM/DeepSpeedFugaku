# 124M model benchmarking results

## Overview
### Model hyperparameters
- --num-layers 12 
- --hidden-size 768 
- --num-attention-heads 12 

### Notations
- MBS = micro batch size
- GBS = global batch size
- Sec/it = seconds per iteration 
- Est. Aggr. PetaFLOPs = TFLOPs * Nodes / 1024

## Experiments

### Sequence Length=1024, w\o Activation Checkpointing, PyTorch 1.10
| Nodes | Size | DP | TP | PP | MBS |  GBS | Mem  | Sec/it | TFLOPs |Est. Aggr. PetaFLOPs| Notes |
| ----: | ---: | -: | -: | -: | --: |  --: | ---: | -----: | -----: | ---: | ----: |
|   1 | 124M |1 |  1 |  1 |   1 | 1024 |  - MiB | - | -| - |- |
|   1 (2.2Hz) | 124M |1 |  1 |  1 |   1 | 1024| - MiB | - | -| - |- |
|   2 | 124M | 2 |  1 |  1 |   1 | 1024 |  - MiB | - | -| - |- |
|   4 | 124M | 2 |  2 |  1 |   1 | 1024 |  - MiB | - | -| - |- |
|   64 | 124M | 64 |  2 |  1 |   1 | 1024 |  - MiB | - | -| - |- |
|   256 | 124M | 64 |  4 |  1 |   1 | 1024 |  - MiB | - | -| - |- |
| 512 | 124M | 512 |  1 | 1  |   1 | 1024 |- MiB | - | -| - |- |
| 512  (2.2Hz)| 124M | 512 |  1 | 1  |   2 | - MiB | - | -| - |- |
|  1024 | 124M |512 |  1 | 1  |   2 | 1024 | - MiB | - | -| - |- |
|  1024 | 124M | 1024 |  1 | 1  |   1 | 1024 | - MiB | - | -| - |- |
| 2048 | 124M | 1024 |  2 | 1  |   2 | 1024 | - MiB | - | -| - |- |
| 4096 | 124M | 1024 |  4 | 1  |   1 | 1024 | - MiB | - | -| - |- |
| 12288 | 124M | 1024 |  12 | 1  |   1 | 1024 | - MiB | - | -| - |- |
| 12288 (2.2Hz) | 124M | 1024 |  12 | 1  |   1 | 1024 | - MiB | - | -| - |- |


### Sequence Length=1024, w\o Activation Checkpointing, PyTorch 1.7
| Nodes | Size | DP | TP | PP | MBS |  GBS | Mem  | Sec/it | TFLOPs |Est. Aggr. PetaFLOPs| Notes |
| ----: | ---: | -: | -: | -: | --: |  --: | ---: | -----: | -----: | ---: | ----: |
|   1 | 124M |1 |  1 |  1 |   1 | 1024 |  7718.0 MiB | 1489.7 | 0.56| 0.0005 |02-15 |
|   1 (2.2Hz) | 124M |1 |  1 |  1 |   1 | 1024| 7701.2 MiB | 1261.2 | 0.66| 0.0006 |02-15 |
| 512 | 124M | 512 |  1 | 1  |   1 | 1024 |7789.2 MiB | 4.2 | 0.38 | 0.19 | 02-15 |
| 512  (2.2Hz)| 124M | 512 |  1 | 1  |   2 | 1024 |11046.9 MiB | 3.2 | 0.50| 0.25 |02-15 |

### Sequence Length=1024, \w Activation Checkpointing, PyTorch 1.7
| Nodes | Size | DP | TP | PP | MBS |  GBS | Mem  | Sec/it | TFLOPs* |Est. Aggr. PetaFLOPs| Notes |
| ----: | ---: | -: | -: | -: | --: |  --: | ---: | -----: | -----: | ---: | ----: |
|   1 | 124M |1 |  1 |  1 |   1 | 1024 | 4103.2 MiB | 2157.3 |  0.52 | 0.0005 | 02-15 |
|   1 (2.2Hz) | 124M |1 |  1 |  1 |   1 | 1024 | 4078.4 MiB | 1804.3 |  0.62 | 0.0006 | 02-14 |
|   1 | 124M |1 |  1 |  1 |   2 | 1024 | 5088.4 MiB | 1552.4 |  0.72 | 0.0007 | 02-15  |
|   1 (2.2Hz) | 124M |1 |  1 |  1 |   2 | 1024 |  4991.5 MiB | 1593.3 | 0.70| 0.0007 | 02-15 |
|   1 | 124M |1 |  1 |  1 |   4 | 1024 | 5827.4 MiB | 1649.9 |  0.68 | 0.0007 | 02-15  |
|   1 (2.2Hz) | 124M |1 |  1 |  1 |   4 | 1024 |  5873.3 MiB | 1433.3 | 0.78| 0.0008 | 02-15 |
|   64 | 124M |64 |  1 |  1 |   1 | 1024 | 4489.9 MiB| 36.1 |  0.48 |  0.03 | 02-14 |
|   64 (2.2Hz) | 124M |64 |  1 |  1 |   1 | 1024 | 4551.8 MiB | 31.3 |  0.56 | 0.035 | 02-14 |
|  256 | 124M | 256 |  1 |  1 |   1 | 1024 | 4587.9 MiB | 9.9 | 0.42 | 0.105 | 02-14 |
|  256 (2.2Hz) | 124M | 256 |  1 | 1  |   1 | 1024 | 4548.1 MiB | 8.7 | 0.50| 0.125 |02-15  |
|  256 (2.2Hz) | 124M | 256 |  1 | 1  |   2 | 1024 |5243.2 MiB | 7.6 | 0.57| 0.142 |02-15 |
|  256 (2.2Hz) | 124M | 256 |  1 | 1  |   4 | 1024 | 5446.9 MiB | 7.3 | 0.59| 0.147 |02-15 |
| 512 | 124M | 512 |  1 | 1  |   1 | 1024 |4551.8 MiB | 5.4 | 0.40 | 0.200 | 02-15 |
| 512  (2.2Hz)| 124M | 512 |  1 | 1  |   2 | 1024 |5213.7 MiB | 4.2 | 0.51| 0.255 |02-15 |

### 1.3 Sequence Length=2048, w\o Activation Checkpointing, PyTorch 1.7
| Nodes | Size | DP | TP | PP | MBS |  GBS | Mem  | Sec/it | TFLOPs* |Est. Aggr. PetaFLOPs| Notes |
| ----: | ---: | -: | -: | -: | --: |  --: | ---: | -----: | -----: | ---: | ----: |
|   1 | 124M |1 |  1 |  1 |   1 | 1024 |  - MiB | - | -| - |- |
| 512 | 124M | 512 |  1 | 1  |   1 | 1024 |17041.5 MiB | 10.4 | 0.37 | 0.185 | 02-15 |
| 4096 | 124M | 1024 |  4 | 1  |   1 | 1024 | - MiB | - | -| - |- |
| 12288 | 124M | 1024 |  12 | 1  |   1 | 1024 | - MiB | - | -| - |- |
| 12288 (2.2Hz) | 124M | 1024 |  12 | 1  |   1 | 1024 | - MiB | - | -| - |- |



## Comments
